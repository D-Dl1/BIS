<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8"/>
        <title>Territorial.io</title>
        <meta name="viewport" content="width=device-width, maximum-scale=1">
        <style>
            .iframe-container {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                border: none;
            }
            body {
                margin: 0;
                padding: 0;
                font-family: 'Arial', sans-serif;
                background-color: #f0f2f5;
                color: #333;
            }

            /* æ‚¬æµ®æŒ‰é’®æ ·å¼ */

            .floating-btn-container {
                position: fixed;
                bottom: 100px;
                left: 15px;
                z-index: 999;
            }

            .floating-btn {
                position: relative;
                width: 40px;
                height: 40px;
                background: linear-gradient(135deg, #868686, #06266f);
                border-radius: 50%;
                display: flex;
                justify-content: center;
                align-items: center;
                cursor: pointer;
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
                transition: all 0.3s ease;
                z-index: 1;
                opacity: 0.5; /* è®¾ç½®æ•´ä½“é€æ˜åº¦ */
            }
            .floating-btn.active {
                position: relative;
                width: 40px;
                height: 40px;
                background: linear-gradient(135deg, #1240ab, #06266f);
                border-radius: 50%;
                display: flex;
                justify-content: center;
                align-items: center;
                cursor: pointer;
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
                z-index: 1;
                opacity: 1; /* è®¾ç½®æ•´ä½“é€æ˜åº¦ */
            }

            .floating-btn:hover {
                transform: scale(1.1);
                box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
            }

            .floating-btn span {
                font-size: 18px;
                color: white;
            }

            .button-group {
                opacity: 0.9; /* è®¾ç½®æ•´ä½“é€æ˜åº¦ */
                position: absolute;
                bottom: 70px;
                left: 50%;
                transform: translateX(-50%) translateY(20px);
                display: flex;
                flex-direction: column-reverse;
                gap: 15px;
                opacity: 0;
                pointer-events: none;
                transition: all 0.3s ease;
                align-items: center;
            }

            .floating-btn-container.active .button-group {
                opacity: 1;
                pointer-events: all;
                transform: translateX(-50%) translateY(0);
            }

            .sub-btn {
                width: 50px;
                height: 50px;
                background: linear-gradient(135deg, #1240ab, #06266f);
                border-radius: 50%;
                display: flex;
                justify-content: center;
                align-items: center;
                cursor: pointer;
                color: white;
                font-size: 20px;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.15);
                transition: all 0.2s ease;
            }
            .sub-btn:hover {
                transform: scale(1.1);
                background: linear-gradient(135deg, #1a52d1, #0a3aa8);
            }

            /* å…¨å±æ§åˆ¶é¢æ¿æ ·å¼ - ä¼˜åŒ–ç§»åŠ¨ç«¯é€‚é… */
            .control-panel {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: linear-gradient(135deg, #1240ab, #06266f);
                z-index: 1001;
                display: none;
                transform: translateX(-100%);
                transition: transform 0.4s ease-out;
                overflow: hidden;
                box-sizing: border-box;
            }

            .control-panel.active {
                transform: translateX(0);
            }

            .panel-header {
                text-align: center;
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 12px 15px;
                background: rgba(6, 38, 111, 0.8);
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
                opacity: 0;
                transition: opacity 0.4s ease-out 0.2s;
                backdrop-filter: blur(5px);
                position: sticky;
                top: 0;
                z-index: 20;
                height: 60px; /* å›ºå®šé«˜åº¦ */
            }

            .control-panel.active .panel-header {
                opacity: 1;
            }

            .panel-title {
                font-size: 20px;
                font-weight: bold;
                color: #ffffff;
                text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
                margin: 0 auto;
                flex: 1;
            }

            .panel-version {
                display: none; /* ç§»é™¤ç‰ˆæœ¬å· */
            }

            .close-btn {
                width: 30px;
                height: 30px;
                background: #d40000;
                color: white;
                border-radius: 50%;
                display: flex;
                justify-content: center;
                align-items: center;
                cursor: pointer;
                font-size: 18px;
                line-height: 1;
                transition: all 0.2s ease;
                z-index: 10;
                position: absolute;
                right: 15px;
            }

            .close-btn:hover {
                background: #ff2727;
                transform: scale(1.1);
            }

            .panel-content {
                color: #fff;
                line-height: 1.5;
                padding: 10px 15px;
                opacity: 0;
                transition: opacity 0.4s ease-out 0.2s;
                height: calc(100% - 120px); /* ä¼˜åŒ–é«˜åº¦è®¡ç®— */
                overflow: hidden;
                box-sizing: border-box;
                -webkit-overflow-scrolling: touch;
            }

            .control-panel.active .panel-content {
                opacity: 1;
            }

            /* é€‰é¡¹å¡æ ·å¼ - ä¼˜åŒ–ç§»åŠ¨ç«¯ */
            .tab-buttons {
                display: flex;
                justify-content: center; /* æŒ‰é’®å±…ä¸­ */
                gap: 8px;
                padding: 10px 15px;
                background: rgba(6, 38, 111, 0.6);
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
                position: sticky;
                top: 60px; /* åŒ¹é…headeré«˜åº¦ */
                z-index: 10;
                overflow-x: auto;
                white-space: nowrap;
                -webkit-overflow-scrolling: touch;
                scrollbar-width: none; /* éšè—æ»šåŠ¨æ¡ */
            }

            .tab-buttons::-webkit-scrollbar {
                display: none; /* éšè—æ»šåŠ¨æ¡ */
            }

            .tab-btn {
                padding: 8px 16px;
                border: none;
                border-radius: 5px;
                background: #1240ab;
                color: white;
                font-weight: bold;
                cursor: pointer;
                transition: all 0.3s ease;
                box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
                font-size: 14px;
                flex-shrink: 0;
                min-width: 80px; /* è®¾ç½®æœ€å°å®½åº¦ */
                text-align: center;
            }

            .tab-btn:hover {
                background: #1a52d1;
            }

            .tab-btn.active {
                background: #4CAF50;
                transform: translateY(-2px);
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            }

            /* é€‰é¡¹å¡å†…å®¹åŒºåŸŸ - ä¼˜åŒ–ç§»åŠ¨ç«¯ */
            .tab-content {
                display: none;
                padding: 15px;
                background: rgba(255, 255, 255, 0.1);
                border-radius: 8px;
                margin: 10px;
                max-height: 100%; /* ä¼˜åŒ–é«˜åº¦è®¡ç®— */
                overflow-y: auto;
                box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.2);
                margin-bottom: 15px;
                -webkit-overflow-scrolling: touch;
                box-sizing: border-box;
            }

            .tab-content.active {
                display: block;
                animation: fadeIn 0.5s ease;
            }

            /* è¿›åº¦æ¡æ ·å¼ */
            .progress-container {
                width: 100%;
                background: rgba(255, 255, 255, 0.1);
                border-radius: 5px;
                margin: 10px 0;
                height: 6px;
            }

            .progress-bar {
                height: 100%;
                border-radius: 5px;
                background: linear-gradient(90deg, #4CAF50, #8BC34A);
                width: 0%;
                transition: width 0.3s ease;
            }

            /* è‡ªå®šä¹‰æ»šåŠ¨æ¡ */
            .tab-content::-webkit-scrollbar {
                width: 6px;
            }

            .tab-content::-webkit-scrollbar-track {
                background: rgba(0, 0, 0, 0.1);
                border-radius: 4px;
            }

            .tab-content::-webkit-scrollbar-thumb {
                background: rgba(255, 255, 255, 0.3);
                border-radius: 4px;
            }

            .tab-content::-webkit-scrollbar-thumb:hover {
                background: rgba(255, 255, 255, 0.5);
            }

            /* å†…å®¹å¡ç‰‡æ ·å¼ */
            .card {
                background: rgba(255, 255, 255, 0.15);
                border-radius: 8px;
                padding: 12px;
                margin-bottom: 12px;
                backdrop-filter: blur(5px);
                border: 1px solid rgba(255, 255, 255, 0.1);
            }

            .card h3 {
                margin-top: 0;
                color: #fff;
                border-bottom: 1px solid rgba(255, 255, 255, 0.2);
                padding-bottom: 8px;
                font-size: 16px;
            }

            .card p {
                color: rgba(255, 255, 255, 0.8);
                font-size: 14px;
                margin: 8px 0;
            }

            /* è¦†ç›–å±‚æ ·å¼ */
            .overlay {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.5);
                z-index: 1000;
                display: none;
                backdrop-filter: blur(3px);
            }

            /* ç§»åŠ¨ç«¯ç‰¹å®šä¼˜åŒ– */
            @media (max-width: 768px) {
                .panel-header {
                    padding: 10px 15px;
                    height: 50px;
                }
                
                .panel-title {
                    font-size: 18px;
                }
                
                .close-btn {
                    width: 26px;
                    height: 26px;
                    font-size: 16px;
                }
                
                .tab-buttons {
                    top: 50px;
                    padding: 8px 10px;
                }
                
                .tab-btn {
                    padding: 6px 12px;
                    font-size: 13px;
                    min-width: 70px;
                }
                
                .tab-content {
                    padding: 10px;
                    margin: 8px;
                    max-height: calc(100vh - 140px);
                    margin-bottom: 10px;
                }
                
                .panel-content {
                    padding: 8px 10px;
                    height: calc(100% - 110px);
                }
                
                .card {
                    padding: 10px;
                }
            }
        </style>
    </head>
<body>
    <div class="floating-btn-container" id="floatingBtnContainer">
        <div class="button-group-bg"></div>
        <div class="floating-btn" id="floatingBtn">
            <span id="btnSymbol">ğŸ”’</span>
        </div>
        <div class="button-group">
            <div class="sub-btn" id="subBtn1">âš™ï¸</div>
            <div class="sub-btn" id="subBtn2" onclick="switchToFirstIframe()">ğŸ </div>
            <div class="sub-btn" id="subBtn3">â–¶ï¸</div>
            <div class="sub-btn" id="subBtn4" onclick="switchToNextIframe()">âš¡</div>
            <div class="sub-btn" id="subBtn5">ğŸ’°</div>
            <div class="sub-btn" id="subBtn6">ğŸ”§</div>
        </div>
    </div>

    <div class="overlay" id="overlay"></div>

    <div class="control-panel" id="controlPanel">
        <div class="panel-header">
            <div class="panel-title">ğŸ•¹ï¸ TT box</div>
            <div class="panel-version">v0.1.2</div>
            <div class="close-btn" id="closeBtn">Ã—</div>
        </div>
        
        <div class="tab-buttons">
            <button class="tab-btn active" data-tab="tab1">ç•Œé¢</button>
            <button class="tab-btn" data-tab="tab2">æ§åˆ¶</button>
            <button class="tab-btn" data-tab="tab3">è®¾ç½®</button>
            <button class="tab-btn" data-tab="tab4">å…³äº</button>
        </div>
        
        <div class="panel-content">
            <div id="tab1" class="tab-content active">
                <button onclick="createCustomIframe('Page '+iframeManager.currentId)">
                    åˆ›å»ºæ–°é¡µé¢
                    </button><hr>
                <div class="card" id="iframe_insert">
                    <h3>é¡µé¢åˆ—è¡¨</h3>
                    <!-- åˆ—è¡¨å°†åŠ¨æ€ç”Ÿæˆåœ¨è¿™é‡Œ -->
                </div>   
            </div>
            
            <div id="tab2" class="tab-content">
                <div class="card">
                    <h3>æ¸¸æˆæ¨¡å¼</h3>
                    <select>
                        <option>åæ´æ¨¡å¼</option>
                        <option>TTæ¨¡å¼</option>
                        <option>å…¨è‡ªåŠ¨ç«èµ›</option>
                        <option>å…¨è‡ªåŠ¨åƒµå°¸</option>
                    </select>
                </div>
                <div class="card">
                    <h3>è¿›æ”»é€Ÿåº¦</h3>
                    <p>æ¯è½®è¿›æ”»äººæœºæ•°é‡</p>
                    <input value="3" type="number" id="attack_number_input"></input>
                </div>
                <div class="card">
                    <h3>è¿›æ”»æ¯”ä¾‹</h3>
                    <p>æ¯è½®è¿›æ”»äººæœºè¶…è¿‡äººæœºæœ€é«˜æ¯”ä¾‹</p>
                    <input value="2" type="number" id="attack_percentage_input"></input>
                </div>
            </div>
            
            <div id="tab3" class="tab-content">
                <div class="card">
                    <h3>å­é¡µurl</h3>
                    <input value="opentt.html" id="iframe_url_input"></input>
                </div>
            </div>
            
            <div id="tab4" class="tab-content">
                <div class="card">
                    <h3>ğŸ•¹ï¸ TT box</h3>
                    <p>version 0.1.2</p>b
                </div>
                <div class="card">
                    <h3>ğŸ“ å¿«æ·é”®</h3>
                    <p>âš™ï¸ - æ‰“å¼€æ§åˆ¶é¢æ¿</p>
                    <p>ğŸ  - å›åˆ°ä¸»é¡µï¼ˆé»˜è®¤idæœ€å°å€¼ï¼‰</p>
                    <p>â–¶ï¸ - è‡ªåŠ¨å¼€å±€</p>
                    <p>âš¡ - åˆ‡æ¢æ ‡ç­¾é¡µ</p>
                    <p>ğŸ’° - å¿«é€Ÿå¢æ´</p>
                    <p>ğŸ”§ - (æš‚æœªå¼€æ”¾)</p>
                    <p>
                    <p>Ctrl+Q - æ‰“å¼€/å…³é—­æ§åˆ¶é¢æ¿</p>
                </div>
                <div class="card">
                    <h3>æ“ä½œè¯´æ˜</h3>
                    <p>åˆæ¬¡ä½¿ç”¨è¯·å°†æ‰€æœ‰è´¦å·å†ä¸»å·é¡µé¢åˆ›å»ºå®Œæ¯•</p>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        //iframe ç®¡ç†
        class IframeManager {
  constructor() {
    this.currentId = 0;
    this.deletedIds = [];
    this.iframeMap = new Map();
    this.iframeListElement = document.getElementById('iframe_insert');
    this.renderList();
  }

  // åˆ›å»ºiframeå‡½æ•°
  createIframe(name = 'New Page') {
    const id = this.getNextId();
    const iframe = document.createElement('iframe');
    
    iframe.className = 'iframe-container';
    iframe.src = document.getElementById("iframe_url_input").value;
    iframe.frameBorder = '0';
    iframe.id = `iframe-${id}`;
    iframe.style.zIndex = '0';
    iframe.style.position = 'fixed';
    
    document.body.appendChild(iframe);
    this.iframeMap.set(id, {
      element: iframe,
      name: name,
      zIndex: 0,
      editing: false
    });
    
    setTimeout(() => {
      if (iframe.contentWindow) {
        iframe.contentWindow.postMessage(`newid${id}`, '*');
      }
    }, 500);
    
    this.renderList();
    return id;
  }

  // åˆ é™¤iframeå‡½æ•°
  deleteIframe(id) {
    const entry = this.iframeMap.get(id);
    
    if (entry) {
      entry.element.remove();
      this.iframeMap.delete(id);
      this.deletedIds.push(id);
      this.deletedIds.sort((a, b) => a - b);
      this.renderList();
      return true;
    }
    
    return false;
  }

  // å‘é€æ¶ˆæ¯åˆ°æŒ‡å®šiframe
  sendMessage(id, message) {
    const entry = this.iframeMap.get(id);
    
    if (entry && entry.element.contentWindow) {
      entry.element.contentWindow.postMessage(message, '*');
      return true;
    }
    
    return false;
  }

  // æ‰“å¼€iframeï¼ˆæå‡z-indexï¼‰
  openIframe(id) {
    controlPanel.classList.remove('active');
    setTimeout(() => {
        controlPanel.style.display = 'none';
        overlay.style.display = 'none';
    }, 400);
    this.iframeMap.forEach((entry, key) => {
      entry.zIndex = key === id ? 2 : 0;
      entry.element.style.zIndex = entry.zIndex;
    });
    this.renderList();
  }

  // åˆ‡æ¢é‡å‘½åæ¨¡å¼
  toggleRename(id) {
    
    const entry = this.iframeMap.get(id);
    if (!entry) return;
    
    if (entry.editing) {
      // ä¿å­˜æ–°åç§°
      const input = document.getElementById(`name-input-${id}`);
      if (input) {
        entry.name = input.value.trim() || 'Unnamed';
      }
    }
    
    entry.editing = !entry.editing;
    this.renderList();
  }

  // è·å–ä¸‹ä¸€ä¸ªå¯ç”¨ID
  getNextId() {
    if (this.deletedIds.length > 0) {
      return this.deletedIds.shift();
    }
    
    return this.currentId++;
  }

  // æ¸²æŸ“iframeåˆ—è¡¨
  renderList() {
    // æ¸…ç©ºç°æœ‰åˆ—è¡¨ï¼Œä¿ç•™æ ‡é¢˜è¡Œ
    while (this.iframeListElement.children.length > 1) {
      this.iframeListElement.removeChild(this.iframeListElement.lastChild);
    }
    
    // æŒ‰IDæ’åºåæ·»åŠ è¡Œ
    Array.from(this.iframeMap.entries())
      .sort((a, b) => a[0] - b[0])
      .forEach(([id, entry]) => {
        const row = document.createElement('div');
        row.style.display = 'flex';
        row.style.alignItems = 'center';
        row.style.padding = '8px 0';
        row.style.borderBottom = '1px solid #eee';
        
        const idSpan = document.createElement('span');
        idSpan.textContent = `id:${id}`;
        idSpan.style.width = '80px';
        idSpan.style.fontWeight = entry.zIndex === 2 ? 'bold' : 'normal';
        
        let nameElement;
        if (entry.editing) {
          const input = document.createElement('input');
          input.type = 'text';
          input.id = `name-input-${id}`;
          input.value = entry.name;
          input.style.width = '110px';
          input.style.marginLeft = '10px';
          input.style.padding = '2px';
          nameElement = input;
        } else {
          const nameSpan = document.createElement('span');
          nameSpan.textContent = entry.name;
          nameSpan.style.width = '120px';
          nameSpan.style.marginLeft = '10px';
          nameElement = nameSpan;
        }
        
        const openBtn = document.createElement('button');
        openBtn.textContent = 'æ‰“å¼€';
        openBtn.style.marginLeft = '10px';
        openBtn.style.padding = '4px 8px';
        openBtn.style.backgroundColor = '#4CAF50';
        openBtn.style.color = 'white';
        openBtn.style.border = 'none';
        openBtn.style.borderRadius = '4px';
        openBtn.style.cursor = 'pointer';
        openBtn.onclick = () => this.openIframe(id);
        
        const renameBtn = document.createElement('button');
        renameBtn.textContent = entry.editing ? 'ä¿å­˜' : 'æ”¹å';
        renameBtn.style.marginLeft = '10px';
        renameBtn.style.padding = '4px 8px';
        renameBtn.style.backgroundColor = '#2196F3';
        renameBtn.style.color = 'white';
        renameBtn.style.border = 'none';
        renameBtn.style.borderRadius = '4px';
        renameBtn.style.cursor = 'pointer';
        renameBtn.onclick = () => this.toggleRename(id);
        
        const deleteBtn = document.createElement('button');
        deleteBtn.textContent = 'åˆ é™¤';
        deleteBtn.style.marginLeft = '10px';
        deleteBtn.style.padding = '4px 8px';
        deleteBtn.style.backgroundColor = '#f44336';
        deleteBtn.style.color = 'white';
        deleteBtn.style.border = 'none';
        deleteBtn.style.borderRadius = '4px';
        deleteBtn.style.cursor = 'pointer';
        deleteBtn.onclick = () => this.deleteIframe(id);
        
        row.appendChild(idSpan);
        row.appendChild(nameElement);
        row.appendChild(openBtn);
        row.appendChild(renameBtn);
        row.appendChild(deleteBtn);
        
        this.iframeListElement.appendChild(row);
      });
  }
}

// åˆ›å»ºå•ä¾‹å®ä¾‹
const iframeManager = new IframeManager();

// æš´éœ²API
window.createCustomIframe = (name) => iframeManager.createIframe(name);
window.deleteCustomIframe = (id) => iframeManager.deleteIframe(id);
window.sendMessageToIframe = (id, message) => iframeManager.sendMessage(id, message);
window.openCustomIframe = (id) => iframeManager.openIframe(id);
window.toggleRenameIframe = (id) => iframeManager.toggleRename(id);

// åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªiframeå¹¶æ˜¾ç¤ºä¿¡æ¯
function switchToNextIframe() {
  const entries = Array.from(iframeManager.iframeMap.entries());
  if (entries.length === 0) return;
  
  // æ‰¾åˆ°å½“å‰æ¿€æ´»çš„iframe
  let currentIndex = -1;
  const activeId = entries.find(([id, entry]) => entry.zIndex === 2)?.[0];
  
  if (activeId !== undefined) {
    currentIndex = entries.findIndex(([id]) => id === activeId);
  }
  
  // è®¡ç®—ä¸‹ä¸€ä¸ªiframeçš„ç´¢å¼•
  const nextIndex = (currentIndex + 1) % entries.length;
  const [nextId, nextEntry] = entries[nextIndex];
  
  // æ¿€æ´»ä¸‹ä¸€ä¸ªiframe
  iframeManager.openIframe(nextId);
  
  // æ»šåŠ¨åˆ°é¡¶éƒ¨
  window.scrollTo({
    top: 0,
    behavior: 'smooth'
  });
  
  // æ˜¾ç¤ºå¼¹çª—
  showInfoPopup(`id:${nextId}`, nextEntry.name);
}

// åˆ‡æ¢åˆ°IDæœ€å°çš„iframe
function switchToFirstIframe() {
  const entries = Array.from(iframeManager.iframeMap.entries());
  if (entries.length === 0) return;
  
  // æŒ‰IDæ’åº
  entries.sort((a, b) => a[0] - b[0]);
  const [firstId, firstEntry] = entries[0];
  
  // æ¿€æ´»ç¬¬ä¸€ä¸ªiframe
  iframeManager.openIframe(firstId);
  
  // æ˜¾ç¤ºå¼¹çª—
  showInfoPopup(`id:${firstId}`, firstEntry.name);
}

// æ˜¾ç¤ºä¿¡æ¯å¼¹çª—ï¼ˆè¾…åŠ©å‡½æ•°ï¼‰
function showInfoPopup(idText, nameText) {
  // åˆ›å»ºå¼¹çª—å…ƒç´ 
  const popup = document.createElement('div');
  popup.style.position = 'fixed';
  popup.style.top = '50%';
  popup.style.left = '50%';
  popup.style.transform = 'translate(-50%, -50%)';
  popup.style.backgroundColor = 'rgba(0, 0, 0, 0.7)';
  popup.style.color = 'white';
  popup.style.padding = '20px';
  popup.style.borderRadius = '10px';
  popup.style.fontSize = '18px';
  popup.style.textAlign = 'center';
  popup.style.zIndex = '1000';
  popup.style.opacity = '0';
  popup.style.transition = 'opacity 0.3s ease-in-out';
  popup.style.boxShadow = '0 4px 8px rgba(0, 0, 0, 0.2)';
  
  // è®¾ç½®å†…å®¹ï¼ˆåç§°åœ¨ä¸Šï¼ŒIDåœ¨ä¸‹ï¼‰
  popup.innerHTML = `
    <div style="margin-bottom: 8px; font-weight: bold;">${nameText}</div>
    <div>${idText}</div>
  `;
  
  // æ·»åŠ åˆ°é¡µé¢
  document.body.appendChild(popup);
  
  // æ˜¾ç¤ºå¼¹çª—
  setTimeout(() => {
    popup.style.opacity = '1';
  }, 10);
  
  // è‡ªåŠ¨éšè—
  setTimeout(() => {
    popup.style.opacity = '0';
    setTimeout(() => {
      document.body.removeChild(popup);
    }, 300);
  }, 500);
}
        
        // æ‚¬æµ®æŒ‰é’®æ§åˆ¶
        const floatingBtn = document.getElementById('floatingBtn');
        const floatingBtnContainer = document.getElementById('floatingBtnContainer');
        const btnSymbol = document.getElementById('btnSymbol');
        const controlPanel = document.getElementById('controlPanel');
        const overlay = document.getElementById('overlay');
        const closeBtn = document.getElementById('closeBtn');

        floatingBtn.addEventListener('click', () => {
            floatingBtnContainer.classList.toggle('active');
            floatingBtn.classList.toggle('active');
            btnSymbol.textContent = floatingBtnContainer.classList.contains('active') ? 'ğŸ”“' : 'ğŸ”’';
        });

        // å­æŒ‰é’®1ç‚¹å‡»äº‹ä»¶
        document.getElementById('subBtn1').addEventListener('click', () => {
            controlPanel.style.display = 'block';
            overlay.style.display = 'block';
            setTimeout(() => {
                controlPanel.classList.add('active');
            }, 10);
            //floatingBtnContainer.classList.remove('active');
            //btnSymbol.textContent = 'ğŸ”’';
        });

        // æ›´æ–°æŒ‰é’®çŠ¶æ€å’Œæ ·å¼
        function updateButtonState(isRunning) {
        if (isRunning) {
            controlBtn.textContent = 'â¸ï¸';
            controlBtn.classList.add('bg-red-500');
            controlBtn.classList.remove('bg-blue-500');
        } else {
            controlBtn.textContent = 'â–¶ï¸';
            controlBtn.classList.add('bg-blue-500');
            controlBtn.classList.remove('bg-red-500');
        }
        }

        // å…³é—­æ§åˆ¶é¢æ¿
        closeBtn.addEventListener('click', closePanel);
        overlay.addEventListener('click', closePanel);

        function closePanel() {
            controlPanel.classList.remove('active');
            setTimeout(() => {
                controlPanel.style.display = 'none';
                overlay.style.display = 'none';
            }, 400);

        }

        // é€‰é¡¹å¡åˆ‡æ¢åŠŸèƒ½
        const tabButtons = document.querySelectorAll('.tab-btn');
        const tabContents = document.querySelectorAll('.tab-content');

        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                // ç§»é™¤æ‰€æœ‰æŒ‰é’®å’Œå†…å®¹çš„activeç±»
                tabButtons.forEach(btn => btn.classList.remove('active'));
                tabContents.forEach(content => content.classList.remove('active'));
                
                // ä¸ºå½“å‰æŒ‰é’®å’Œå¯¹åº”å†…å®¹æ·»åŠ activeç±»
                button.classList.add('active');
                const tabId = button.getAttribute('data-tab');
                document.getElementById(tabId).classList.add('active');
            });
        });
        // è·å–å½“å‰æ‰€æœ‰åœ¨çº¿iframeçš„IDåˆ—è¡¨ï¼ˆæŒ‰IDå‡åºæ’åˆ—ï¼‰
function getActiveIframeIds() {
  const activeIds = Array.from(iframeManager.iframeMap.keys())
    .sort((a, b) => a - b);
    
  return activeIds;
}
    </script>
    <script>
        document.addEventListener('keydown', function(event) {
            if (event.key === 'q') {
                floatingBtn.classList.toggle('active');
                if (controlPanel.style.display === 'block') {
                    controlPanel.classList.remove('active');
                    setTimeout(() => {
                        controlPanel.style.display = 'none';
                        overlay.style.display = 'none';
                    }, 400);
                } else {
                    setTimeout(() => {
                    controlPanel.classList.add('active');
                }, 10);
                    controlPanel.style.display = 'block';
                    overlay.style.display = 'block';
                }
            }
        });
    </script>
    <!-- UI <=> SCRIPT LINE -->
    <script>
        window.addEventListener('message', function(event) {
            if (event.data["type"] === "id") {
                all_id[event.data["data"][0]] = event.data["data"][1]
                console.log('æ”¶åˆ°å­é¡µé¢æ¶ˆæ¯:', event.data);
            }
            if (event.data["type"] === "tick") {
                tick = event.data["data"]
            }
            
        });
        let tick = 0;
        let attackTimer = null;
        const attacking_logic = [
            [(0 *5.5 +5.5*0.652)*1000, 0, 28.8],
            [(1 *5.5 +5.5*0.6625)*1000, 0, 35.23],
            [(2 *5.5 +5.5*0.659)*1000, 0, 32.7],
            [(3 *5.5 +5.5*0.5)*1000, 0, 28],
            [(3 *5.5 +5.5*0.75)*1000, 0, 37],
            [(3 *5.5 +5.5*0.9)*1000, 0, 37],
            [(4 *5.5 +5.5*0.6)*1000, 0, 28],
            [(4 *5.5 +5.5*0.75)*1000, 0, 32],
            [(4 *5.5 +5.5*0.9)*1000, 0, 32],
            [(5 *5.5 +5.5*0.4)*1000, 0, 30],
            [(5 *5.5 +5.5*0.6)*1000, 0, 30],
            [(5 *5.5 +5.5*0.75)*1000, 0, 30],
            [(5 *5.5 +5.5*0.9)*1000, 0, 30],
            [(6 *5.5 +5.5*0.7)*1000, 0, 30],
            [(7 *5.5 +5.5*0.7)*1000, 0, 30],

            [(7 *5.5 +5.5*0.7)*1000, 1, 5],
            [(8 *5.5 +5.5*0.7)*1000, 1, 5],
            [(9 *5.5 +5.5*0.7)*1000, 1, 5],
            [(10 *5.5 +5.5*0.7)*1000, 1, 4],
            [(11 *5.5 +5.5*0.7)*1000, 1, 4],
        ];
        const executedAttacks = new Set();
        const controlBtn = document.getElementById('subBtn3');

        // åˆå§‹åŒ–æŒ‰é’®çŠ¶æ€
        updateButtonState(false);
        controlBtn.addEventListener('click', toggleAttackTimer);

        function toggleAttackTimer() {if (attackTimer) {stopAttackTimer();} else {startAttackTimer();}}
        var all_id = {};
        var id_list = getActiveIframeIds();
        function startAttackTimer() {
            all_id = {};
            id_list = getActiveIframeIds();
            
            for (let index = 0; index < id_list.length; index++) {
                sendMessageToIframe(id_list[index],{id:id_list[index],type:"search"})
            }
            setTimeout(() => {
                console.log(all_id)
            }, 1000);
            var is_empty = true
            if (attackTimer) clearInterval(attackTimer);
            
            tick = 0;
            executedAttacks.clear();
            
            attackTimer = setInterval(() => {
                const currentTick = get_time();
                if (currentTick !== tick) {
                    tick = currentTick;
                    
                    for (let i = 0; i < attacking_logic.length; i++) {
                        const [triggerTick, type, percentage] = attacking_logic[i];
                        if (tick >= triggerTick && !executedAttacks.has(i)) {
                            console.log("attack"+i+" - "+percentage+"%")
                            if (type === 0 && hD(aD.eR) && is_empty) {
                                b7.h3.hE(percentage*10,512)
                            }
                            if (hD(aD.eR) === false && is_empty) {
                                is_empty == false
                                console.log("stop")
                            }
                            if (type === 1 && is_empty===false) {
                                attack_robot(percentage*10);
                            }
                            if (type === 2) {
                                
                            }
                            executedAttacks.add(i);
                        }
                    }
                }
                //console.log(get_time())
            }, 20);
            
            updateButtonState(true);
        }

        function stopAttackTimer() {
            var all_id = {};
            if (attackTimer) {
                clearInterval(attackTimer);
                attackTimer = null;
                console.log('æ”»å‡»è®¡æ—¶å™¨å·²åœæ­¢');
                updateButtonState(false);
            }
        }
    </script>
    
    </body>
</html>